window.CONFIG={API_BASE_URL:"http://www.thecover.cn/",API:{INDEX:"getMore",CHANNEL:"getMore",SEARCH:"searchMore"}},window.Helper={$window:$(window),$html:$("html"),$body:$("body"),wW:$(window).width(),wH:$(window).height(),docH:$(document).height(),flag_footer_top:$("#footer_flag").offset().top,atPage:function(e){return-1!==this.$body.prop("class").split(" ").indexOf("pagetype-"+e)},isElementInViewport:function(e){var t=e.get(0),n=t.getBoundingClientRect();return n.top>=0&&n.left>=0&&n.bottom<=this.wH&&n.right<=this.wW},isElementInViewport_Vertical:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=this.wH},update_dimensions:function(){return{wW:this.wW=this.$window.width(),wH:this.wH=this.$window.height(),docH:this.docH=$(document).height(),flag_footer_top:this.flag_footer_top=$("#footer_flag").offset().top}},promise_img:function(e){var t=$.Deferred(),n=e.data("src"),i=$("<img>");return i.attr("src",n),i.on("load",function(){t.resolve(e)}),i.on("error",function(){t.reject(e)}),t.promise()},load_img:function(e){$(e).removeClass("hidden")},Timer_Scroll_0:!0,Timer_Scroll_1:!0,scroll_with_delay:function(e,t,n,i){var o=this["Timer_Scroll_"+e];this.$window.on("scroll."+t,function(){o&&window.clearTimeout(o),o=window.setTimeout(function(){n()},i)})},getHtml:function(e,t){return $.ajax({url:CONFIG.API_BASE_URL+e,method:"GET",data:t,dataType:"html"})},getSearchHistory:function(){var e=/\s/;if(!localStorage.getItem("the_cover"))return!1;var t=localStorage.getItem("the_cover").split("|"),n=[];return $.each(t,function(t,i){i.match(e)||n.push(i)}),n.length>0?n:!1},setSearchHistory:function(e){if(this.getSearchHistory()){var t=this.getSearchHistory();if(-1!==$.inArray(e,t))return!1;t.push(e),localStorage.setItem("the_cover",t.join("|"))}else localStorage.setItem("the_cover","|"+e)},bindEvents:function(){var e=this;e.$window.on("resize",function(){e.update_dimensions()})}},window.Comp={slider:{init:function(e,t){var n=$.Deferred();if(0===e.length)return n.resolve(Helper.$body.removeClass("hidden")),n.promise();if(e.data("initialized")===!0)return n.resolve();var i=e.find(".each-slide-of-banner-a-container"),o=t||{loop:!0,autoplay:4e3,speed:500,autoplayDisableOnInteraction:!0,effect:"fade",pagination:e.find(".swiper-pagination"),paginationClickable:!0,onInit:function(){return Helper.$body.removeClass("hidden"),n.promise()}};$.when(Helper.promise_img(i.eq(0))).done(function(){i.each(function(){$(this).css({"background-image":"url("+$(this).data("src")+")"})}),new Swiper("#banner_slider_container",o),e.data("initialized",!0)})}},dotdotdot:{init:function(){$.each(["#banner_slider_container .each-slide-of-banner figcaption p.des",".grid-item a.link-to-article .description-wrapper h2",".express-news-scroll-area li section h3",".guess-your-interests h3",".express-news-scroll-area li>a .content"],function(e,t){return $(t)?$(t).dotdotdot({}):void 0})}},page_header:{init:function(e){var t=location.pathname.split("/")[1];e.find(".top-nav>li").each(function(e,n){return $(n).data("pagetype")===t?$(n).addClass("current"):void 0}),this.bindEvents(e)},bindEvents:function(e){var t=e.find(".search-form");e.on("click",".search-icon",function(e){e.preventDefault();var n=$(this);t.css({left:180+$(".top-nav").width()+"px","margin-left":"-80px"}).promise().then(function(){t.toggleClass("active"),n.toggleClass("focus"),t.find(".search-field").focus(),t.hasClass("active")&&t.find(".search-history li").addClass("hidden")})})}},express_news:{init:function(e){var t=this,n=e.find("#express_news");return t.setPosition(e,n).done(function(){return n.perfectScrollbar({wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20,maxScrollbarLength:150,suppressScrollX:!0}),n.removeClass("hidden"),t.bindEvents(e,n)})},bindEvents:function(e,t){var n=$.Deferred(),i=this;return Helper.$window.on("scroll",function(){i.changeStyle(t)}),Helper.$window.on("resize",function(){i.setPosition(e,t).then(function(){t.perfectScrollbar("update")})}),n.promise()},changeStyle:function(e){var t=$("#footer_flag").get(0),n=$("#footer");Helper.isElementInViewport_Vertical(t)&&!n.hasClass("hidden")?e.addClass("go-with-parent"):e.removeClass("go-with-parent")},setPosition:function(e,t){var n=Helper.wW-e.offset().left-e.width(),i=Helper.wH-$(".header-wrapper").height()-30-1;return t.css({top:"85px",right:n+"px",height:i+"px",overflow:"hidden"}).promise()}},packery:{init:function(e,t){return t&&t.col,e.packery({initLayout:!1,itemSelector:".grid-item",gutter:10,stamp:".packery-stamp",transitionDuration:"0.2s"}),this.bindEvents(e)},bindEvents:function(e){var t=$.Deferred(),n=$("#express_news");return e.on("layoutComplete",function(){return e.removeClass("hidden"),n.removeClass("with-parent"),t.resolve()}),e.packery()&&t.promise()}},video_player:{init:function(e){videojs.options.flash.swf="./video-js.swf";var t=e.find("video").get(0);return this.bindEvents(videojs(t,{inactivityTimeout:600},function(){setTimeout(function(){e.addClass("show")},300)}))},bindEvents:function(e){setTimeout(function(){e.userActive(!0)},1500)}},search_func:{init:function(e){var t=$('<ul class="search-history"></ul>');return Helper.$html.hasClass("no-localstorage")?!1:(e&&e.find("#sc_inp").focus(),Helper.getSearchHistory()?($.each(Helper.getSearchHistory(),function(e,n){n&&""!==n&&" "!==n&&t.append('<li class="hidden"><a href="http://170.240.110.243/fmWeb-web/search?q='+n+'&pageindex=1">'+n+"</a></li>")}),$(".search-form").append(t)):Helper.setSearchHistory(""),this.bindEvents(t))},bindEvents:function(e){var t=/\s/;$(".search-field").on("keyup",function(){var t=$(this).val(),n=new RegExp("^"+t);""!==t&&" "!==t&&e.find("li").each(function(){return $(this).text().match(n)?void $(this).removeClass("hidden"):$(this).addClass("hidden")})}).on("keydown",function(e){return 13===e.keyCode?$(this).val().match(t)?e.preventDefault():Helper.setSearchHistory($(this).val()):void 0})}},scroll_and_load:{init:function(e,t){var n=$.Deferred();if(!e.hasClass("scroll-and-load"))return n.reject();var i=e.find("#btn_load_more").data("counts",{scrolled_time:0,can_scroll_time:t.can_scroll_time});return i&&n.resolve(),this.bindEvents(i,t)&&n.promise()},bindEvents:function(e,t){var n=this,i=$("#express_news"),o=e.get(0);Helper.scroll_with_delay(0,"load_more",function(){if(Helper.$body.hasClass("loading-more-cards"))return!1;if(Helper.isElementInViewport_Vertical(o)){if(e.data("counts").scrolled_time++===e.data("counts").can_scroll_time)return e.removeClass("hidden"),$("#footer").removeClass("hidden"),Comp.express_news.changeStyle(i),Helper.$window.off("scroll.load_more");Helper.$body.addClass("loading-more-cards"),n.fetchMoreCard(t,i).done(function(t,i,o){return Helper.$body.removeClass("loading-more-cards"),n.reRender(t,$(".packery-container"),e),Helper.docH=$(document).height()}).fail(function(e,t,n){})}},100),e.on("click",function(e){var o=$(this);return o.hasClass("frozen")||o.hasClass("hidden")?e.preventDefault():(o.html('<span>加载中 </span><em class="blink-0 blink">。</em><em class="blink-1 blink">。</em><em class="blink-2 blink">。</em>').addClass("frozen"),Helper.$body.addClass("loading-more-cards"),void n.fetchMoreCard(t,i).done(function(e,t,i){return Helper.$body.removeClass("loading-more-cards"),o.html("<span>加载更多</span>").removeClass("frozen"),n.reRender(e,$(".packery-container"),o)}).fail(function(e,t,n){}))})},fetchMoreCard:function(e,t){var n=$(".packery-container").data("params");return t.removeClass("go-with-parent"),Helper.getHtml(e.API,n)},reRender:function(e,t,n){var i=$(e);t.append(i).packery("appended",i);var o=t.find("#card_params");return t.data("params",o.data("params")),o.removeAttr("id"),"-1"==t.data("params").lastid?($("#footer").removeClass("hidden"),Helper.$window.off("scroll.load_more"),n.html("<span>没有更多了~ </span>").removeClass("hidden").addClass("frozen").off("click")):void 0}},float_widgets:{init:function(e){var t=e.find("#btn_back_to_top_container").css({bottom:$("#footer").height()+110+"px"}),n=$(".content-wrapper");this.setPosition(Helper.wW,t,n);$("#share_icons").css({left:e.find(".content-wrapper").offset().left-$("#share_icons").width()+"px"}).promise().done(function(){$(this).removeClass("hidden")});return this.bindEvents(t)},bindEvents:function(e){var t=this,n=$(".content-wrapper");Helper.$window.on("scroll",function(){$(this).scrollTop()>Helper.wH?e.addClass("show"):e.removeClass("show")}),Helper.$window.on("resize",function(){t.setPosition(Helper.wW,e,n)}),e.find("#btn_back_to_top").on("click",function(){return $("html, body").animate({scrollTop:"0px"})}),e.find(".with-hover").hover(function(){e.find(".qr-container").toggleClass("show")}),$(".share-icons").find(".share-to-wechat").each(function(){$(this).hover(function(){$(this).siblings(".panel-weixin").toggleClass("show")})})},setPosition:function(e,t,n){e>1350?t.css({left:n.offset().left+n.width()+"px",right:"unset"}):e>1200?t.css({left:"unset",right:"0px"}):e>1065?t.css({left:n.offset().left+n.width()+"px",right:"unset"}):t.css({left:"unset",right:"0px"})}},fullscreen_cover_layer:{init:function(e){this.bindEvents(e)},bindEvents:function(e){var t=(e.find(".btn-comment"),e.find("#cover_layer"));e.on("click",".btn-comment, #cover_layer",function(e){e.preventDefault(),t.toggleClass("show")})}},tabs:{init:function(e){return this.showSection(location.hash,e),this.bindEvents(e)},bindEvents:function(e){var t=this;Helper.$window.on("hashchange",function(){t.showSection(location.hash,e)}),e.find(".nav-li").on("click",function(n){n.preventDefault(),t.showSection($(this).data("section"),e)})},showSection:function(e,t){location.hash=e,$(e).siblings(".section").addClass("hidden"),$(e).removeClass("hidden"),Helper.$window.scrollTop(0),t.find(".nav-li").each(function(t,n){return $(n).data("section")===e?$(n).addClass("active"):$(n).removeClass("active")})}},fixedHeight:{init:function(){Helper.$body.height(Helper.wH-82)}}},Helper.$window.on("beforeunload",function(){Helper.$window.scrollTop(0)}),$(document).ready(function(){Helper.bindEvents(),Comp.page_header.init($(".header-wrapper")),Comp.dotdotdot.init(),Comp.float_widgets.init(Helper.$body),Comp.search_func.init(),Helper.atPage("index")&&(Comp.scroll_and_load.init($("body"),{API:CONFIG.API.INDEX,can_scroll_time:3}),$.when(Comp.express_news.init($(".responsive-wrapper")),Comp.packery.init($(".packery-container"))).done(function(){Comp.slider.init($("#banner_slider_container"))})),Helper.atPage("video-detail")&&Comp.video_player.init($("#video-player-wrapper")),Helper.atPage("detail")&&Comp.fullscreen_cover_layer.init($("body")),Helper.atPage("search-results")&&(Comp.packery.init($(".packery-container")),Comp.scroll_and_load.init($("body"),{API:CONFIG.API.SEARCH,can_scroll_time:3})),Helper.atPage("channel")&&(Comp.packery.init($(".packery-container"),{col:4}),Comp.scroll_and_load.init($("body"),{API:CONFIG.API.CHANNEL,can_scroll_time:3})),Helper.atPage("more")&&Comp.tabs.init($(".index-wrapper")),(Helper.atPage("404")||Helper.atPage("maintenance"))&&Comp.fixedHeight.init()});